<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />	

<link rel="stylesheet" href="../../css/style.css"/>
<script type="text/javascript" src="../js/common.js"></script>
<script language="javascript" src="../sheet/ibsheetinfo.js"></script>
<script language="javascript" src="../sheet/ibsheet.js"></script>
<title>IBSheet7-Product</title>
</head>

<script language="javascript">
	var pageheightoffset = 170;

	/*Sheet 기본 설정 */
	function LoadPage() {
		var initData = {};
		initData.Cfg = {SearchMode:2, Page:50,MergeSheet:msHeaderOnly,ChildPage:10,DragMode:1	};
		initData.Cols = [
		{Header:"",Type:"DummyCheck", SaveName:"chk", Width:35, Align:"Center",Edit:1,HeaderCheck:0},
			{Header:"직급",Type:"Text", SaveName:"sPos", Width:60, Align:"Center"},
			{Header:"성명",Type:"Text", SaveName:"sName", Width:50, Align:"Center",Edit:0},
			{Header:"성별",Type:"Combo", SaveName:"sSex", Width:40, Align:"Center",ComboText:"男|女",ComboCode:"남|여"},
			{Header:"연령대",Type:"Text", SaveName:"sAge2", Width:50, Align:"Center"},
			{Header:"거주지1",Type:"Text", SaveName:"sAddr1", Width:50, Align:"Center"},
			{Header:"나이",Type:"Int", SaveName:"sAge", Width:50, Align:"Right"},
		];
		IBS_InitSheet(mySheet,initData);
		
		
		
		
		initData.Cols = [
			{Header:"부서/성명",Type:"Text", SaveName:"sName", Width:150, Align:"Left",TreeCol:1},
			{Header:"직급",Type:"Text", SaveName:"sPos", Width:60, Align:"Center",Edit:0},
			{Header:"성별",Type:"Text", SaveName:"sSex", Width:50, Align:"Center"},
			{Header:"연령대",Type:"Text", SaveName:"sAge2", Width:50, Align:"Center"},
			{Header:"거주지1",Type:"Text", SaveName:"sAddr1", Width:80, Align:"Center"},
			{Header:"나이",Type:"Int", SaveName:"sAge", Width:50, Align:"Right"}
		];
		
		IBS_InitSheet(mySheet2,initData);
		
//		mySheet.SetSelectionMode(3);
		mySheet.SetDataAutoTrim(0);

	}


	function mySheet_OnDropEnd(FromSheet, FromRow, ToSheet, ToRow, X, Y, Type) {
		//같은 시트에서는 데이터이동 안됨.
		if(FromSheet == ToSheet) return;
		
		var json = FromSheet.GetRowJson(FromRow);
		
		//신규행 추가
		var row = ToSheet.DataInsert(ToRow+1);
		//행 데이터 복사
		ToSheet.SetRowJson(row,{"Data":[json]});
		
		
		
		//원본 데이터 삭제
		FromSheet.RowDelete(FromRow);
		
	}



	//드레그 드롭 데이터 이동
	function mySheet2_OnDropEnd(FromSheet, FromRow, ToSheet, ToRow, X, Y, Type) {
		var json = FromSheet.GetRowJson(FromRow);
		
		var posRow = FromRow;
		if(FromSheet==ToSheet&&ToRow<FromRow){
			//같은 시트내에서 이동은 신경을 써야 함.	
			posRow++;
		}
		var lvl = ToSheet.GetRowLevel(ToRow);
		if(lvl<2) return;
		
		//신규행 추가
		var row = ToSheet.DataInsert(ToRow+1,3);
		//행 데이터 복사
		ToSheet.SetRowJson(row,{"Data":[json]});
		
		//원본 데이터 삭제
		FromSheet.RowDelete(posRow);
		
		
		
	}





	/*Sheet 각종 처리*/
	function doAction(sAction) {
		switch(sAction) {
			case "search":
				mySheet.DoSearch("tree_move_data.json");
				mySheet2.DoSearch("tree_move_data2.json");
				break;
			case "reload":
				mySheet.RemoveAll();
				break;
			case "save":      
				var str = mySheet.GetSaveString();
				alert(str);
				break;
			case "insert":
				mySheet.DataInsert(); 
				break; 
		}
	}
	
	//버튼을 이용한 이동
	function move(to){
		var ToSheet,FromSheet;
		if(to=="toRight"){
			ToSheet = mySheet2;
			FromSheet = mySheet;
			//체크된 행이 있는지 찾아본다.
			var rows = FromSheet.FindCheckedRow("chk");
			//복사될 위치를 구한다.
			var ToRow = ToSheet.GetSelectRow();
			if(ToSheet.GetRowLevel(ToRow)<2){
				alert("오른쪽 시트에서 붙여넣을 팀을 선택해 주세요");
				return;
			}
			if(rows==""){
				//현재 포커스가 들어간 행을	이동시킨다.
				var FromRow = FromSheet.GetSelectRow();
				mySheet2_OnDropEnd(FromSheet, FromRow, ToSheet, ToRow, 0,0, 0);
			}else{
				//체크된 행을 모두 복사.	
				var jsonArr = [];
				var rs = rows.split("|");
				for(var i=0;i<rs.length;i++){
					var r = ToSheet.DataInsert(ToRow+1,3);
					ToSheet.SetRowJson(r, {"Data":[FromSheet.GetRowJson(rs[i])]});
				}
				//원본 데이터 삭제
				FromSheet.RowDelete(rows);
			}
		}else{ //toLeft
			ToSheet = mySheet;
			FromSheet = mySheet2;
		}	
	}
	function mySheet_OnSearchEnd(code,msg){
		if($(window).width()>1300){
			mySheet.FitColWidth();	
			mySheet2.FitColWidth();	
		}
	}


	
</script>

<body onLoad="LoadPage()">
        <div class="page_title">
            <span><a class="closeDepth" href="#">closeDepth</a></span>
            <span class="title">데이터 이동 &gt; <b>트리 데이터 이동</b></span>
        </div>
                
        <div class="main_content">
            <div class="exp_product">
                좌/우측 데이터를 버튼이나 Drag&Drop을 통해 이동해 본다. 
            </div>
        
            <div class="ib_function float_right">
                <a href="javascript:doAction('reload')" class="f1_btn_gray lightgray">초기화</a>
                <a href="javascript:doAction('search')" class="f1_btn_white gray">조회</a>
            </div>

			<div class="clear hidden"></div>  
            
            

			<p class="subtit_sheet">조회리스트</p>
			<DIV class="ib_product" style="width:100%;float:left">
				<div style="height:100%;width:45%;float:left">
					<script type="text/javascript"> createIBSheet("mySheet", "100%", "100%"); </script>
				</div>
				
				<div style="height:100%;width:10%;float:left;">
					<div style="position:relative; top:50%; text-align:center">
						<a href="javascript:move('toRight');" class="f2_btn_white btn_sheet">&gt;</a>
					</div>
				</div>
				
				
				<div style="height:100%;width:45%;float:left">
					<script type="text/javascript"> createIBSheet("mySheet2", "100%", "100%"); </script>
				</div>
			</DIV>
          
    </div>
    <!--main_content-->

</body>
</html>








